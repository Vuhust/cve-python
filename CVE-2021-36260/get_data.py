import sys
from shodan import Shodan
import pprint
import requests
import json

from pathlib import Path

def write_result(file, data):
    f = Path(file)
    if( f.is_file() == False):
        print("    " +file + "not exit!")
        return False
    temp = open(file, 'a')
    temp.write(data)
    temp.close
    


pp = pprint.PrettyPrinter(depth=16)

# host = sys.argv[1]
api = Shodan('hRyW5EDhFjJQhAmz5TVKKpYQUZR8Vxnw')
# f = open("temp.txt")
# pp.
cve = "CVE-2021-36160"
query = 'vuln:'+cve +', country:vn'
result = api.search(query,facets=None)
pp.pprint(result)

result_arr =[]
for x in result["matches"]:
    result_arr.append(x["ip_str"])

print(len(result_arr))
write_result("data.txt", json.dumps(result_arr))