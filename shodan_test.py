import sys
from shodan import Shodan
import pprint
import requests
import json

pp = pprint.PrettyPrinter(depth=16)

# host = sys.argv[1]
api = Shodan('hRyW5EDhFjJQhAmz5TVKKpYQUZR8Vxnw')
# f = open("temp.txt")
# pp.
query = 'vuln:CVE-2021-31207, country:vn'
result = api.search(query,facets=None)
# pp.pprint(result)
# pp.pprint(api.search(query,facets=None))

# print(type(result["matches"]))
result_arr = []
for x in result["matches"]:
    hostname = x["hostnames"]
    domains = x["domains"]
    # print("hostname")
    for x in domains:
        if(x.startswith("mail")) :
            result_arr.append(x)  
        else :
            x = "mail." +x   
            result_arr.append(x)
    for x in hostname:
        if (x.startswith("mail") == False):
            result_arr.append(x)
            x = "mail." + x         
            for y in domains :
                if  x == y :
                    break
            result_arr.append(x)
        else :
            result_arr.append(x)
        
    # break
print(len(result_arr))
print(json.dumps(result_arr))
    # print("domains")            

        
    # break     
    # pp.pprint()
#     for x in x :
        # pp.pprint(type(x))
        # break



# query = sys.argv[1]
# pp.pprint(api.search(query, page=1, facets=None))

# pp.pprint(api.host(host))
# if api.count('vuln:CVE-2021-31207',facets=None )["total"] != 0 :
#     print(api.count('vuln:CVE-2021-31207',facets=None )["total"])
#the required first parameter of the 'get' method is the 'url':
# x = requests.get('https://access.redhat.com/labs/securitydataapi/cve.json?package=kernel&after=2021-01-01')
# print(type(x.text))
# result = json.loads(x.text)
# for x in result: 
#     print("check "+x["CVE"])
#     query = "vuln:"+x["CVE"]
#     if api.count(query+" country:vn", facets=None) ["total"] != 0 :
#         print(x["CVE"])

    # pp.pprint(x)
# print(x.text)

# # f.write    
# # 
# result = api.count(query+" country:vn", facets=None) ["total"]
# if  result != 0 :
#     print(result)